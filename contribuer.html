
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Frise dynamique - Fiche descriptive</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #f4f4f4;
      display: flex;
      height: 100vh;
    }
    .years-column {
      width: 120px;
      background: #fff;
      border-right: 1px solid #ccc;
      overflow-y: auto;
      padding: 1rem;
    }
    .year {
      cursor: pointer;
      margin-bottom: 0.5rem;
    }
    .year.active {
      font-weight: bold;
      color: #007b7f;
    }
    .events-column {
      flex: 2;
      overflow-y: auto;
      padding: 1rem;
      background: #fdfdfd;
    }
    .event {
      border: 1px solid #ddd;
      margin-bottom: 1rem;
      padding: 0.5rem;
      background: #fff;
      cursor: pointer;
    }
    .fiche-column {
      flex: 1;
      border-left: 1px solid #ccc;
      padding: 1rem;
      background: #fff;
    }
    .keyword {
      color: #007bff;
      cursor: pointer;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="years-column" id="year-list"></div>
  <div class="events-column" id="event-list"></div>
  <div class="fiche-column">
    <h2 id="fiche-titre">Détails</h2>
    <div id="fiche-content">Cliquez sur un événement pour afficher les détails.</div>
  </div>
  <script>
    let eventsData = [];

    fetch("events.json")
      .then(res => res.json())
      .then(data => {
        eventsData = data;
        const years = [...new Set(data.map(e => parseInt(e.start)))].sort((a, b) => a - b);
        const yearList = document.getElementById("year-list");
        const eventList = document.getElementById("event-list");

        years.forEach(year => {
          const y = document.createElement("div");
          y.className = "year";
          y.textContent = year;
          y.onclick = () => {
            document.querySelectorAll(".year").forEach(el => el.classList.remove("active"));
            y.classList.add("active");
            renderEvents(year);
          };
          yearList.appendChild(y);
        });

        function renderEvents(year) {
          eventList.innerHTML = "";
          eventsData.forEach(evt => {
            if (year >= evt.start && year <= evt.end) {
              const div = document.createElement("div");
              div.className = "event";
              div.textContent = evt.title + ` (${evt.start} – ${evt.end})`;
              div.dataset.title = evt.title;
              div.dataset.start = evt.start;
              div.dataset.end = evt.end;
              div.dataset.maincat = evt.maincat;
              div.dataset.subcat = evt.subcat;
              div.dataset.themes = evt.themes;
              div.dataset.keywords = evt.keywords;
              div.dataset.description = evt.description;
              div.dataset.source = evt.source;
              div.onclick = () => showDetails(div);
              eventList.appendChild(div);
            }
          });
        }

        function showDetails(el) {
          const titre = el.dataset.title;
          const start = el.dataset.start;
          const end = el.dataset.end;
          const maincat = el.dataset.maincat;
          const subcat = el.dataset.subcat;
          const themes = el.dataset.themes;
          const keywords = el.dataset.keywords.split(",").map(k => `<span class="keyword">${k.trim()}</span>`).join(", ");
          const desc = el.dataset.description;
          const source = el.dataset.source;

          document.getElementById("fiche-titre").textContent = `${titre} (${start} – ${end})`;
          document.getElementById("fiche-content").innerHTML = `
            <p><strong>Catégories :</strong> ${maincat} / ${subcat}</p>
            <p><strong>Thèmes :</strong> ${themes}</p>
            <p><strong>Mots-clés :</strong> ${keywords}</p>
            <p>${desc}</p>
            ${source ? `<p><a href="${source}" target="_blank">Source</a></p>` : ""}
          `;
        }
      })
      .catch(err => {
        document.body.innerHTML = "<p>Erreur de chargement des événements.</p>";
        console.error(err);
      });
  </script>
</body>
</html>
